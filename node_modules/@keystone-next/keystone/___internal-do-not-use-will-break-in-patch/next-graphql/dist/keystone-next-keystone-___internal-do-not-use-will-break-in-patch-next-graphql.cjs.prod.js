'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var initConfig = require('../../../dist/initConfig-ea0b3b38.cjs.prod.js');
var createApolloServer = require('../../../dist/createApolloServer-49225e32.cjs.prod.js');
require('@babel/runtime/helpers/objectSpread2');
require('../../../dist/core-7942250b.cjs.prod.js');
require('../../../dist/sqlite-6dd56161.cjs.prod.js');
require('../../../dist/graphql-ts-schema-4c18b24a.cjs.prod.js');
require('@graphql-ts/schema');
require('graphql-type-json');
require('graphql-upload/public/GraphQLUpload.js');
require('graphql');
require('decimal.js');
require('@graphql-ts/schema/api-without-context');
require('@graphql-ts/extend');
require('@graphql-ts/schema/api-with-context');
require('@graphql-tools/schema');
require('@babel/runtime/helpers/objectWithoutProperties');
require('../../../dist/graphql-errors-a907a8e6.cjs.prod.js');
require('apollo-server-errors');
require('path');
require('util');
require('fs-extra');
require('fast-glob');
require('resolve');
require('@nodelib/fs.walk');
require('@emotion/hash');
require('../../../dist/admin-meta-graphql-c4e50813.cjs.prod.js');
require('@apollo/client');
require('@babel/runtime/helpers/classPrivateFieldInitSpec');
require('@babel/runtime/helpers/classPrivateFieldGet');
require('@babel/runtime/helpers/classPrivateFieldSet');
require('p-limit');
require('../../../dist/types-for-lists-7c049b0a.cjs.prod.js');
require('graphql/execution/values');
require('pluralize');
require('@babel/runtime/helpers/defineProperty');
require('uuid');
require('image-type');
require('image-size');
require('../../../fields/types/image/utils/dist/keystone-next-keystone-fields-types-image-utils.cjs.prod.js');
require('crypto');
require('stream');
require('filenamify');
require('@sindresorhus/slugify');
require('../../../fields/types/file/utils/dist/keystone-next-keystone-fields-types-file-utils.cjs.prod.js');
require('node-fetch');
require('form-data');
require('cuid');
require('../../../dist/package-path-261b12e7.cjs.prod.js');
require('apollo-server-micro');
require('apollo-server-express');
require('apollo-server-core');
require('../../../session/dist/keystone-next-keystone-session.cjs.prod.js');
require('cookie');
require('@hapi/iron');
require('uid-safe');

function nextGraphQLAPIRoute(keystoneConfig, prismaClient) {
  var _keystoneConfig$graph;

  const initializedKeystoneConfig = initConfig.initConfig(keystoneConfig);
  const {
    graphQLSchema,
    getKeystone
  } = initConfig.createSystem(initializedKeystoneConfig);
  const keystone = getKeystone(prismaClient);
  keystone.connect();
  const apolloServer = createApolloServer.createApolloServerMicro({
    graphQLSchema,
    createContext: keystone.createContext,
    sessionStrategy: initializedKeystoneConfig.session,
    graphqlConfig: initializedKeystoneConfig.graphql,
    connectionPromise: keystone.connect()
  });
  return apolloServer.createHandler({
    path: ((_keystoneConfig$graph = keystoneConfig.graphql) === null || _keystoneConfig$graph === void 0 ? void 0 : _keystoneConfig$graph.path) || '/api/graphql'
  });
}

exports.nextGraphQLAPIRoute = nextGraphQLAPIRoute;
